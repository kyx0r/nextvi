#!/bin/sh
# Generated by patch2vi from unified diff
# Separator: '@'
set -e

# Path to nextvi (adjust as needed)
VI=${VI:-vi}

# Verify that VI is nextvi
if ! $VI -? 2>&1 | grep -q 'Nextvi'; then
    echo "Error: $VI is not nextvi" >&2
    echo "Set VI environment variable to point to nextvi" >&2
    exit 1
fi

# Patch: ex.c
EXINIT="rcm:|sc! @|vis 6@1399a 	EO(rec),
.
@1337a EO(rec)
.
@25a int xrec;			/* input recoding register */
.
@vis 4@wq" $VI -e 'ex.c'

# Patch: term.c
EXINIT="rcm:|sc! @|vis 6@178a 		if (xrec && *ibuf) {
			char buf[2];
			buf[0] = *ibuf;
			buf[1] = '\\0';
			ex_regput(xrec, buf, 1);
		}
.
@vis 4@wq" $VI -e 'term.c'

# Patch: vi.h
EXINIT="rcm:|sc! @|vis 6@435a extern int xrec;
.
@vis 4@wq" $VI -e 'vi.h'
