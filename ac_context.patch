diff --git a/led.c b/led.c
index 81753cd8..1da10469 100644
--- a/led.c
+++ b/led.c
@@ -11,25 +11,30 @@ int dstrlen(const char *s, char delim)
 	return i-s;
 }
 
-static int search(const char *pattern, int l)
+static int search(sbuf *sb, int l, int pre)
 {
-	if (!*pattern)
+	if (!sb->s[l])
 		return 0;
 	sbuf_cut(suggestsb, 0)
 	sbuf_smake(sylsb, 1024)
-	char *part = strstr(acsb->s, pattern);
+	again:;
+	char *part = strstr(acsb->s, sb->s+l);
 	while (part) {
 		char *part1 = part;
 		while (*part != '\n')
 			part--;
 		int len = dstrlen(++part, '\n');
-		if (len++ != l) {
+		if (len++ != sb->s_n - l) {
 			if (part == part1)
 				sbuf_mem(suggestsb, part, len)
-			else
+			else if (l >= pre)
 				sbuf_mem(sylsb, part, len)
 		}
-		part = strstr(part+len, pattern);
+		part = strstr(part+len, sb->s+l);
+	}
+	if (l < pre && sb->s[pre]) {
+		l = pre;
+		goto again;
 	}
 	sbuf_mem(suggestsb, sylsb->s, sylsb->s_n)
 	free(sylsb->s);
@@ -410,6 +415,10 @@ static int led_line(sbuf *sb, int ps, int pre, char **post, int postn, char **po
 {
 	char *cs;
 	int len, c, i;
+	if (ai_max >= 0 && xpac) {
+		c = 0;
+		goto pac;
+	}
 	do {
 		led_printparts(sb, pre, ps, *post, postn, ai_max);
 		len = sb->s_n;
@@ -517,7 +526,7 @@ static int led_line(sbuf *sb, int ps, int pre, char **post, int postn, char **po
 		case TK_CTL('n'):
 			if (!suggestsb)
 				continue;
-			is->lsug = is->sug_pt >= 0 ? is->sug_pt : led_lastword(sb->s + pre) + pre;
+			is->lsug = is->sug_pt >= 0 ? is->sug_pt : led_lastword(sb->s);
 			if (is->_sug) {
 				if (suggestsb->s_n == is->sug - suggestsb->s)
 					continue;
@@ -528,13 +537,14 @@ static int led_line(sbuf *sb, int ps, int pre, char **post, int postn, char **po
 				}
 				suggest:
 				*is->_sug = '\0';
-				sbuf_cut(sb, is->lsug)
-				sbuf_str(sb, is->sug)
+				for (i = 0; is->sug[i] && sb->s[i+is->lsug] == is->sug[i]; i++){}
+				sbuf_cut(sb, MAX(is->lsug+i, pre))
+				sbuf_str(sb, is->sug+i)
 				is->sug = is->_sug+1;
 				continue;
 			}
 			lookup:
-			if (search(sb->s + is->lsug, len - is->lsug)) {
+			if (search(sb, is->lsug, pre)) {
 				is->sug = suggestsb->s;
 				if (!(is->_sug = strchr(is->sug, '\n')))
 					continue;
@@ -548,8 +558,8 @@ static int led_line(sbuf *sb, int ps, int pre, char **post, int postn, char **po
 				int r = crow-ctop+1;
 				if (is->sug)
 					goto pac_;
-				i = is->sug_pt >= 0 ? is->sug_pt : led_lastword(sb->s + pre) + pre;
-				if (suggestsb && search(sb->s + i, sb->s_n - i)) {
+				is->lsug = is->sug_pt >= 0 ? is->sug_pt : led_lastword(sb->s);
+				if (suggestsb && search(sb, is->lsug, pre)) {
 					is->sug = suggestsb->s;
 					pac_:;
 					preserve(int, xtd, xtd = 2;)
