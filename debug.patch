diff --git a/ex.c b/ex.c
index 694fd97..7a4ddf8 100644
--- a/ex.c
+++ b/ex.c
@@ -1135,3 +1135,11 @@ void ex_init(char **files, int n)
 	if (!(xvis & 2) && (s = getenv("EXINIT")))
 		ex_command(s)
 }
+
+void ex_done(void)
+{
+	for (int i = 0; i < xbufcur; i++)
+		bufs_free(i);
+	rset_free(xkwdrs);
+	free(bufs);
+}
diff --git a/regex.c b/regex.c
index 51d54a4..b45cbf0 100644
--- a/regex.c
+++ b/regex.c
@@ -540,6 +540,7 @@ int re_pikevm(rcode *prog, const char *s, const char **subp, int nsubp, int flg)
 	int *pcs[prog->splits];
 	rsub *subs[prog->splits];
 	unsigned int sdense[prog->sparsesz], sparsesz = 0;
+	memset(sdense, 0, sizeof(int) * prog->sparsesz);
 	rsub *nsub, *s1, *matched = NULL, *freesub = NULL;
 	rthread _clist[prog->len], _nlist[prog->len];
 	rthread *clist = _clist, *nlist = _nlist, *tmp;
diff --git a/ren.c b/ren.c
index f3b49de..cf5fd0d 100644
--- a/ren.c
+++ b/ren.c
@@ -78,6 +78,13 @@ void dir_init(void)
 	dir_rsctx = rset_make(i, ctx, 0);
 }
 
+void dir_done(void)
+{
+	rset_free(dir_rslr);
+	rset_free(dir_rsrl);
+	rset_free(dir_rsctx);
+}
+
 static ren_state rstates[1];
 ren_state *rstate = &rstates[0];
 
@@ -382,3 +389,10 @@ void syn_init(void)
 		pats[i] = fts[i].pat;
 	syn_ftrs = rset_make(i, pats, 0);
 }
+
+void syn_done(void)
+{
+	for (; ftmidx >= 0; ftmidx--)
+		rset_free(ftmap[ftmidx].rs);
+	rset_free(syn_ftrs);
+}
diff --git a/vi.c b/vi.c
index 5e537b6..1ee30ef 100644
--- a/vi.c
+++ b/vi.c
@@ -597,6 +597,12 @@ void vi_regput(int c, const char *s, int ln)
 	vi_regputraw(c, s, ln);
 }
 
+static void vi_regdone(void)
+{
+	for (int i = 0; i < LEN(regs); i++)
+		free(regs[i]);
+}
+
 static void vi_regprint(void)
 {
 	term_pos(xrows, led_pos(vi_msg, 0));
@@ -2054,6 +2060,7 @@ int main(int argc, char *argv[])
 		ex();
 	else
 		vi(1);
+	ex_done();
 	term_done();
 	if (xvis & 4)
 		return EXIT_SUCCESS;
@@ -2062,5 +2069,12 @@ int main(int argc, char *argv[])
 		term_kill();
 	} else
 		term_clean();
+	vi_regdone();
+	syn_done();
+	dir_done();
+	led_done();
+	ren_done();
+	temp_done(1);
+	temp_done(0);
 	return EXIT_SUCCESS;
 }
diff --git a/vi.h b/vi.h
index 039a4d0..9cf2fb8 100644
--- a/vi.h
+++ b/vi.h
@@ -175,6 +175,7 @@ int ren_cwid(char *s, int pos);
 /* text direction */
 int dir_context(char *s);
 void dir_init(void);
+void dir_done(void);
 /* syntax highlighting */
 #define SYN_BD		0x010000
 #define SYN_IT		0x020000
@@ -196,6 +197,7 @@ int syn_merge(int old, int new);
 void syn_reloadft(void);
 int syn_addhl(char *reg, int func, int reload);
 void syn_init(void);
+void syn_done(void);
 
 /* uc.c utf-8 helper functions */
 extern unsigned char utf8_length[256];
@@ -335,6 +337,7 @@ void ex_print(char *line);
 void ex_show(char *msg);
 void ex_init(char **files, int n);
 void ex_bufpostfix(struct buf *p, int clear);
+void ex_done(void);
 int ex_krs(rset **krs, int *dir);
 void ex_krsset(char *kwd, int dir);
 int ex_edit(const char *path, int len);
