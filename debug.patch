diff --git a/ex.c b/ex.c
index 8f13ceb3..245c8393 100644
--- a/ex.c
+++ b/ex.c
@@ -1585,3 +1585,16 @@ void ex_init(char **files, int n)
 	if ((s = getenv("EXINIT")))
 		ex_command(s)
 }
+
+void ex_done(void)
+{
+	for (int i = 0; i < LEN(tempbufs); i++)
+		if (tempbufs[i].lb) {
+			free(tempbufs[i].path);
+			lbuf_free(tempbufs[i].lb);
+		}
+	for (int i = 0; i < xbufcur; i++)
+		bufs_free(i);
+	rset_free(xkwdrs);
+	free(bufs);
+}
diff --git a/regex.c b/regex.c
index 4a0addb8..560c1da7 100644
--- a/regex.c
+++ b/regex.c
@@ -636,6 +636,7 @@ static int re_pikevm(rcode *prog, const char *s, const char **subp, int nsubc, i
 	int si = 0, clistidx = 0, nlistidx, mcont = MATCH;
 	int eol_ch = flg & REG_NEWLINE ? '\n' : 0;
 	unsigned int sdense[prog->sparsesz], sparsesz = 0;
+	memset(sdense, 0, sizeof(int) * prog->sparsesz);
 	char nsubs[prog->sub];
 	for (i = 0; i < prog->laidx; i++)
 		lb[i] = NULL;
diff --git a/ren.c b/ren.c
index cf6a8dc5..ed9a9e6e 100644
--- a/ren.c
+++ b/ren.c
@@ -90,6 +90,19 @@ static int ren_cwid(char *s, int pos)
 ren_state rstates[3]; /* 0 = current line, 1 = all other lines, 2 = aux rendering */
 ren_state *rstate = rstates;
 
+void ren_done(void)
+{
+	rset_free(dir_rslr);
+	rset_free(dir_rsrl);
+	rset_free(dir_rsctx);
+	for (int i = 0; i < LEN(rstates); i++) {
+		if (rstate[i].col) {
+			free(rstate[i].col - 2);
+			free(rstate[i].pos);
+		}
+	}
+}
+
 /* specify the screen position of the characters in s */
 ren_state *ren_position(char *s)
 {
@@ -407,3 +420,10 @@ void syn_init(void)
 		pats[i] = fts[i].pat;
 	syn_ftrs = rset_make(i, pats, 0);
 }
+
+void syn_done(void)
+{
+	for (; ftmidx >= 0; ftmidx--)
+		rset_free(ftmap[ftmidx].rs);
+	rset_free(syn_ftrs);
+}
diff --git a/vi.c b/vi.c
index 2745ebd9..86b71966 100644
--- a/vi.c
+++ b/vi.c
@@ -436,6 +436,13 @@ static void vi_regput(int c, const char *s, int lnmode)
 	ex_regput(tolower(c), s, isupper(c));
 }
 
+static void vi_regdone(void)
+{
+	for (int i = 0; i < LEN(xregs); i++)
+		if (xregs[i])
+			sbuf_free(xregs[i])
+}
+
 rset *fsincl;
 char *fs_exdir;
 static int fspos;
@@ -1825,12 +1832,19 @@ int main(int argc, char *argv[])
 		ex();
 	else
 		vi(1);
+	ex_done();
 	term_done();
+	free(ibuf);
+	rset_free(fsincl);
 	if (abs(xquit) == 2)
 		term_clean();
 	else if (!(xvis & 4)) {
 		term_pos(xrows - !vi_status, 0);
 		term_kill();
 	}
+	vi_regdone();
+	syn_done();
+	ren_done();
+	led_done();
 	return EXIT_SUCCESS;
 }
diff --git a/vi.h b/vi.h
index dcdcc3ca..fe5b6946 100644
--- a/vi.h
+++ b/vi.h
@@ -228,6 +228,7 @@ char *ren_translate(char *s, char *ln);
 /* text direction */
 int dir_context(char *s);
 void dir_init(void);
+void dir_done(void);
 /* syntax highlighting */
 #define SYN_BD		0x10000
 #define SYN_IT		0x20000
@@ -266,6 +267,7 @@ void syn_reloadft(int hl, int flg);
 int syn_findhl(int id);
 int syn_addhl(char *reg, int id);
 void syn_init(void);
+void syn_done(void);
 
 /* uc.c utf-8 helper functions */
 extern unsigned char utf8_length[256];
@@ -475,6 +477,7 @@ void ex_cprint(char *line, char *ft, int r, int c, int left, int flg);
 #define ex_print(line, ft) { RS(2, ex_cprint(line, ft, -1, 0, 0, 1)); }
 void ex_init(char **files, int n);
 void ex_bufpostfix(struct buf *p, int clear);
+void ex_done(void);
 int ex_krs(rset **krs, int *dir);
 void ex_krsset(char *kwd, int dir);
 int ex_edit(const char *path, int len);
